<?xml version="1.0" ?>
<!--
  UFFactory xArm 6 - Simplified SDF Model

  Based on official specifications:
  - DOF: 6
  - Reach: 700mm
  - Payload: 6kg
  - Weight: 9.2kg
  - Repeatability: ±0.1mm

  Link lengths derived from xarm_ros URDF:
  - Base height: 267mm
  - Upper arm (link2): 284.5mm
  - Forearm (link3): 284.5mm
  - Wrist section: ~180mm total

  Joint limits from datasheet:
  - J1: ±360°
  - J2: -118° to +120°
  - J3: -225° to +11°
  - J4: ±360°
  - J5: -97° to +180°
  - J6: ±360°
-->
<sdf version="1.9">
  <model name="xarm6">
    <static>false</static>

    <!-- Base Link (mounted to table) -->
    <link name="link_base">
      <inertial>
        <mass>2.0</mass>
        <inertia>
          <ixx>0.01</ixx><iyy>0.01</iyy><izz>0.01</izz>
        </inertia>
      </inertial>
      <visual name="base_visual">
        <geometry>
          <cylinder><radius>0.065</radius><length>0.05</length></cylinder>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
          <diffuse>0.9 0.9 0.9 1</diffuse>
        </material>
      </visual>
      <collision name="base_collision">
        <geometry>
          <cylinder><radius>0.065</radius><length>0.05</length></cylinder>
        </geometry>
      </collision>
    </link>

    <!-- Link 1: Shoulder rotation (267mm from base to joint 2) -->
    <link name="link1">
      <pose relative_to="joint1">0 0 0 0 0 0</pose>
      <inertial>
        <mass>2.5</mass>
        <pose>0 0 0.1 0 0 0</pose>
        <inertia>
          <ixx>0.02</ixx><iyy>0.02</iyy><izz>0.01</izz>
        </inertia>
      </inertial>
      <visual name="link1_housing">
        <pose>0 0 0.05 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.055</radius><length>0.1</length></cylinder>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
          <diffuse>0.9 0.9 0.9 1</diffuse>
        </material>
      </visual>
      <visual name="link1_shoulder">
        <pose>0 0 0.16 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.05</radius><length>0.12</length></cylinder>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
        </material>
      </visual>
      <collision name="link1_collision">
        <pose>0 0 0.1 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.06</radius><length>0.2</length></cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="joint1" type="revolute">
      <parent>link_base</parent>
      <child>link1</child>
      <pose relative_to="link_base">0 0 0.025 0 0 0</pose>
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-6.28</lower>
          <upper>6.28</upper>
          <effort>50</effort>
          <velocity>3.14</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Link 2: Upper arm (284.5mm) -->
    <link name="link2">
      <pose relative_to="joint2">0 0 0 0 0 0</pose>
      <inertial>
        <mass>1.8</mass>
        <pose>0 0 0.142 0 0 0</pose>
        <inertia>
          <ixx>0.03</ixx><iyy>0.03</iyy><izz>0.005</izz>
        </inertia>
      </inertial>
      <visual name="link2_joint">
        <pose>0 0 0 1.5708 0 0</pose>
        <geometry>
          <cylinder><radius>0.045</radius><length>0.1</length></cylinder>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
        </material>
      </visual>
      <visual name="link2_arm">
        <pose>0 0 0.142 0 0 0</pose>
        <geometry>
          <box><size>0.065 0.055 0.285</size></box>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
        </material>
      </visual>
      <collision name="link2_collision">
        <pose>0 0 0.142 0 0 0</pose>
        <geometry>
          <box><size>0.07 0.06 0.29</size></box>
        </geometry>
      </collision>
    </link>

    <joint name="joint2" type="revolute">
      <parent>link1</parent>
      <child>link2</child>
      <pose relative_to="link1">0 0 0.242 0 0 0</pose>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <lower>-2.06</lower>
          <upper>2.09</upper>
          <effort>50</effort>
          <velocity>3.14</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Link 3: Forearm (284.5mm) -->
    <link name="link3">
      <pose relative_to="joint3">0 0 0 0 0 0</pose>
      <inertial>
        <mass>1.5</mass>
        <pose>0 0 0.142 0 0 0</pose>
        <inertia>
          <ixx>0.025</ixx><iyy>0.025</iyy><izz>0.004</izz>
        </inertia>
      </inertial>
      <visual name="link3_joint">
        <pose>0 0 0 1.5708 0 0</pose>
        <geometry>
          <cylinder><radius>0.04</radius><length>0.08</length></cylinder>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
        </material>
      </visual>
      <visual name="link3_arm">
        <pose>0 0 0.142 0 0 0</pose>
        <geometry>
          <box><size>0.055 0.05 0.285</size></box>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
        </material>
      </visual>
      <collision name="link3_collision">
        <pose>0 0 0.142 0 0 0</pose>
        <geometry>
          <box><size>0.06 0.055 0.29</size></box>
        </geometry>
      </collision>
    </link>

    <joint name="joint3" type="revolute">
      <parent>link2</parent>
      <child>link3</child>
      <pose relative_to="link2">0 0 0.2845 0 0 0</pose>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <lower>-3.93</lower>
          <upper>0.19</upper>
          <effort>32</effort>
          <velocity>3.14</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Link 4: Wrist 1 (82mm) -->
    <link name="link4">
      <pose relative_to="joint4">0 0 0 0 0 0</pose>
      <inertial>
        <mass>1.2</mass>
        <pose>0 0 0.041 0 0 0</pose>
        <inertia>
          <ixx>0.008</ixx><iyy>0.008</iyy><izz>0.003</izz>
        </inertia>
      </inertial>
      <visual name="link4_visual">
        <pose>0 0 0.041 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.035</radius><length>0.082</length></cylinder>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
        </material>
      </visual>
      <collision name="link4_collision">
        <pose>0 0 0.041 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.04</radius><length>0.085</length></cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="joint4" type="revolute">
      <parent>link3</parent>
      <child>link4</child>
      <pose relative_to="link3">0 0 0.2845 0 0 0</pose>
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-6.28</lower>
          <upper>6.28</upper>
          <effort>20</effort>
          <velocity>3.14</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Link 5: Wrist 2 (82mm) -->
    <link name="link5">
      <pose relative_to="joint5">0 0 0 0 0 0</pose>
      <inertial>
        <mass>1.0</mass>
        <pose>0 0 0.041 0 0 0</pose>
        <inertia>
          <ixx>0.006</ixx><iyy>0.006</iyy><izz>0.002</izz>
        </inertia>
      </inertial>
      <visual name="link5_visual">
        <pose>0 0 0.041 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.032</radius><length>0.082</length></cylinder>
        </geometry>
        <material>
          <ambient>0.9 0.9 0.9 1</ambient>
        </material>
      </visual>
      <collision name="link5_collision">
        <pose>0 0 0.041 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.035</radius><length>0.085</length></cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="joint5" type="revolute">
      <parent>link4</parent>
      <child>link5</child>
      <pose relative_to="link4">0 0 0.082 0 0 0</pose>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <lower>-1.69</lower>
          <upper>3.14</upper>
          <effort>20</effort>
          <velocity>3.14</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Link 6: Wrist 3 / Flange (42mm to flange surface) -->
    <link name="link6">
      <pose relative_to="joint6">0 0 0 0 0 0</pose>
      <inertial>
        <mass>0.5</mass>
        <pose>0 0 0.021 0 0 0</pose>
        <inertia>
          <ixx>0.002</ixx><iyy>0.002</iyy><izz>0.001</izz>
        </inertia>
      </inertial>
      <visual name="link6_visual">
        <pose>0 0 0.021 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.03</radius><length>0.042</length></cylinder>
        </geometry>
        <material>
          <ambient>0.3 0.3 0.3 1</ambient>
          <diffuse>0.3 0.3 0.3 1</diffuse>
        </material>
      </visual>
      <visual name="flange">
        <pose>0 0 0.045 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.035</radius><length>0.008</length></cylinder>
        </geometry>
        <material>
          <ambient>0.5 0.5 0.5 1</ambient>
        </material>
      </visual>
      <collision name="link6_collision">
        <pose>0 0 0.025 0 0 0</pose>
        <geometry>
          <cylinder><radius>0.035</radius><length>0.05</length></cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="joint6" type="revolute">
      <parent>link5</parent>
      <child>link6</child>
      <pose relative_to="link5">0 0 0.082 0 0 0</pose>
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-6.28</lower>
          <upper>6.28</upper>
          <effort>20</effort>
          <velocity>3.14</velocity>
        </limit>
      </axis>
    </joint>

    <!-- ==================== GRIPPER ==================== -->

    <!-- Gripper base attached to link6 flange -->
    <link name="gripper_base">
      <pose relative_to="gripper_joint">0 0 0 0 0 0</pose>
      <inertial>
        <mass>0.3</mass>
        <inertia>
          <ixx>0.001</ixx><iyy>0.001</iyy><izz>0.001</izz>
        </inertia>
      </inertial>
      <visual name="base_visual">
        <geometry>
          <box><size>0.04 0.08 0.03</size></box>
        </geometry>
        <material>
          <ambient>0.2 0.2 0.2 1</ambient>
          <diffuse>0.2 0.2 0.2 1</diffuse>
        </material>
      </visual>
      <!-- Camera mount bracket -->
      <visual name="camera_mount">
        <pose>0.03 0 0.02 0 0 0</pose>
        <geometry>
          <box><size>0.03 0.09 0.025</size></box>
        </geometry>
        <material>
          <ambient>0.1 0.1 0.1 1</ambient>
        </material>
      </visual>
      <collision name="gripper_collision">
        <geometry>
          <box><size>0.04 0.08 0.03</size></box>
        </geometry>
      </collision>

      <!-- Intel RealSense D435 (wrist-mounted) -->
      <!--
           D435 specs:
           - Depth FOV: 87° x 58°
           - RGB FOV: 69° x 42°
           - Range: 0.2m - 10m (optimal 0.3m - 3m)
           - Resolution: 1280x720 depth, 1920x1080 RGB
           - Size: 90mm x 25mm x 25mm
      -->
      <visual name="realsense_d435">
        <pose>0.06 0 0.02 0 0 0</pose>
        <geometry>
          <box><size>0.025 0.09 0.025</size></box>
        </geometry>
        <material>
          <ambient>0.05 0.05 0.05 1</ambient>
          <diffuse>0.05 0.05 0.05 1</diffuse>
        </material>
      </visual>

      <sensor name="wrist_d435" type="rgbd_camera">
        <pose>0.07 0 0.02 0 0.4 0</pose>  <!-- Angled down toward work surface -->
        <always_on>1</always_on>
        <update_rate>30</update_rate>
        <topic>wrist_camera</topic>
        <camera>
          <horizontal_fov>1.518</horizontal_fov>  <!-- 87 degrees (D435 depth FOV) -->
          <image>
            <width>640</width>
            <height>480</height>
            <format>R8G8B8</format>
          </image>
          <clip>
            <near>0.2</near>
            <far>10.0</far>
          </clip>
          <depth_camera>
            <clip>
              <near>0.2</near>
              <far>10.0</far>
            </clip>
          </depth_camera>
        </camera>
      </sensor>
    </link>

    <joint name="gripper_joint" type="fixed">
      <parent>link6</parent>
      <child>gripper_base</child>
      <pose relative_to="link6">0 0 0.05 0 0 0</pose>
    </joint>

    <!-- Left finger -->
    <link name="left_finger">
      <pose relative_to="left_finger_joint">0 0 0 0 0 0</pose>
      <inertial>
        <mass>0.05</mass>
        <inertia>
          <ixx>0.0001</ixx><iyy>0.0001</iyy><izz>0.0001</izz>
        </inertia>
      </inertial>
      <visual name="finger_visual">
        <pose>0 0 -0.03 0 0 0</pose>
        <geometry>
          <box><size>0.01 0.012 0.06</size></box>
        </geometry>
        <material>
          <ambient>0.4 0.4 0.4 1</ambient>
        </material>
      </visual>
      <collision name="finger_collision">
        <pose>0 0 -0.03 0 0 0</pose>
        <geometry>
          <box><size>0.01 0.012 0.06</size></box>
        </geometry>
      </collision>
    </link>

    <joint name="left_finger_joint" type="prismatic">
      <parent>gripper_base</parent>
      <child>left_finger</child>
      <pose relative_to="gripper_base">0 0.03 -0.015 0 0 0</pose>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <lower>0</lower>
          <upper>0.02</upper>
          <effort>20</effort>
          <velocity>0.1</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Right finger -->
    <link name="right_finger">
      <pose relative_to="right_finger_joint">0 0 0 0 0 0</pose>
      <inertial>
        <mass>0.05</mass>
        <inertia>
          <ixx>0.0001</ixx><iyy>0.0001</iyy><izz>0.0001</izz>
        </inertia>
      </inertial>
      <visual name="finger_visual">
        <pose>0 0 -0.03 0 0 0</pose>
        <geometry>
          <box><size>0.01 0.012 0.06</size></box>
        </geometry>
        <material>
          <ambient>0.4 0.4 0.4 1</ambient>
        </material>
      </visual>
      <collision name="finger_collision">
        <pose>0 0 -0.03 0 0 0</pose>
        <geometry>
          <box><size>0.01 0.012 0.06</size></box>
        </geometry>
      </collision>
    </link>

    <joint name="right_finger_joint" type="prismatic">
      <parent>gripper_base</parent>
      <child>right_finger</child>
      <pose relative_to="gripper_base">0 -0.03 -0.015 0 0 0</pose>
      <axis>
        <xyz>0 -1 0</xyz>
        <limit>
          <lower>0</lower>
          <upper>0.02</upper>
          <effort>20</effort>
          <velocity>0.1</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Tool frame (tip of gripper fingers) -->
    <frame name="tool_frame" attached_to="gripper_base">
      <pose>0 0 -0.06 0 0 0</pose>
    </frame>

    <!-- ==================== JOINT CONTROLLERS ==================== -->
    <!-- Position controllers for each joint to enable position control -->

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint1</joint_name>
      <initial_position>0</initial_position>
      <p_gain>100</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>10</d_gain>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint2</joint_name>
      <initial_position>-0.6</initial_position>
      <p_gain>100</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>10</d_gain>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint3</joint_name>
      <initial_position>-1.2</initial_position>
      <p_gain>100</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>10</d_gain>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint4</joint_name>
      <initial_position>0</initial_position>
      <p_gain>50</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>5</d_gain>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint5</joint_name>
      <initial_position>-1.0</initial_position>
      <p_gain>50</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>5</d_gain>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint6</joint_name>
      <initial_position>0</initial_position>
      <p_gain>30</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>3</d_gain>
    </plugin>

    <!-- Gripper finger controllers -->
    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>left_finger_joint</joint_name>
      <initial_position>0.01</initial_position>
      <p_gain>20</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>2</d_gain>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>right_finger_joint</joint_name>
      <initial_position>0.01</initial_position>
      <p_gain>20</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>2</d_gain>
    </plugin>

  </model>
</sdf>
